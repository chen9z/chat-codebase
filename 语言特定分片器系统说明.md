# è¯­è¨€ç‰¹å®šåˆ†ç‰‡å™¨ç³»ç»Ÿ

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

è¯­è¨€ç‰¹å®šåˆ†ç‰‡å™¨ç³»ç»Ÿä¸ºæ¯ç§ç¼–ç¨‹è¯­è¨€æä¾›äº†ä¸“é—¨çš„ä»£ç åˆ†ç‰‡é€»è¾‘ï¼Œèƒ½å¤Ÿæ·±åº¦ç†è§£ä¸åŒè¯­è¨€çš„è¯­æ³•ç‰¹å¾ã€ä»£ç æ¨¡å¼å’Œæœ€ä½³å®è·µã€‚ç³»ç»Ÿæ”¯æŒ6ç§ä¸»æµç¼–ç¨‹è¯­è¨€ï¼Œä¸ºæ¯ç§è¯­è¨€æä¾›å®šåˆ¶åŒ–çš„å¤„ç†ç­–ç•¥ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

```
LanguageSpecificSplitter (æŠ½è±¡åŸºç±»)
â”œâ”€â”€ PythonSplitter (Pythonä¸“ç”¨)
â”œâ”€â”€ JavaSplitter (Javaä¸“ç”¨)  
â”œâ”€â”€ JavaScriptSplitter (JavaScript/TypeScriptä¸“ç”¨)
â”œâ”€â”€ GoSplitter (Goä¸“ç”¨)
â”œâ”€â”€ RustSplitter (Rustä¸“ç”¨)
â””â”€â”€ CppSplitter (C/C++ä¸“ç”¨)
```

### è®¾è®¡åŸåˆ™

1. **è¯­è¨€ç‰¹å¼‚æ€§**: æ¯ç§è¯­è¨€æœ‰ç‹¬ç‰¹çš„è¯­ä¹‰ç±»å‹å’Œå¤æ‚åº¦è®¡ç®—
2. **æ™ºèƒ½åˆå¹¶**: åŸºäºè¯­è¨€ç‰¹æ€§çš„æ™ºèƒ½åˆå¹¶ç­–ç•¥
3. **ç‰¹å¾æå–**: æ·±åº¦åˆ†æè¯­è¨€ç‰¹å®šçš„ä»£ç ç‰¹å¾
4. **å‘åå…¼å®¹**: æ— ç¼é›†æˆç°æœ‰åˆ†ç‰‡ç³»ç»Ÿ

## ğŸ“‹ æ”¯æŒçš„è¯­è¨€

| è¯­è¨€ | åˆ†ç‰‡å™¨ç±» | ç‰¹è‰²åŠŸèƒ½ |
|------|----------|----------|
| Python | `PythonSplitter` | å¼‚æ­¥è¯­æ³•ã€è£…é¥°å™¨ã€ç¼©è¿›æ„ŸçŸ¥ |
| Java | `JavaSplitter` | æ³¨è§£ã€æ³›å‹ã€è®¾è®¡æ¨¡å¼æ£€æµ‹ |
| JavaScript/TypeScript | `JavaScriptSplitter` | å¼‚æ­¥ç¼–ç¨‹ã€æ¡†æ¶æ£€æµ‹ã€ç±»å‹æ³¨è§£ |
| Go | `GoSplitter` | å¹¶å‘ç¼–ç¨‹ã€é”™è¯¯å¤„ç†æ¨¡å¼ |
| Rust | `RustSplitter` | æ‰€æœ‰æƒã€ç”Ÿå‘½å‘¨æœŸã€å®‰å…¨æ€§æ£€æµ‹ |
| C/C++ | `CppSplitter` | å†…å­˜ç®¡ç†ã€æ¨¡æ¿ã€ç°ä»£C++ç‰¹æ€§ |

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. è¯­è¨€ç‰¹å®šè¯­ä¹‰ç±»å‹

æ¯ç§è¯­è¨€å®šä¹‰äº†ç‹¬ç‰¹çš„è¯­ä¹‰ç±»å‹å’Œä¼˜å…ˆçº§ï¼š

#### Python è¯­ä¹‰ç±»å‹
```python
class PythonSemanticType(LanguageSpecificSemanticType):
    CLASS = ("class", 10)
    FUNCTION = ("function", 8)
    ASYNC_FUNCTION = ("async_function", 8)
    METHOD = ("method", 8)
    PROPERTY = ("property", 6)
    DECORATOR = ("decorator", 5)
    IMPORT = ("import", 2)
    DOCSTRING = ("docstring", 7)
    EXCEPTION_HANDLER = ("exception_handler", 6)
```

#### Java è¯­ä¹‰ç±»å‹
```python
class JavaSemanticType(LanguageSpecificSemanticType):
    CLASS = ("class", 10)
    INTERFACE = ("interface", 10)
    ENUM = ("enum", 9)
    METHOD = ("method", 8)
    CONSTRUCTOR = ("constructor", 8)
    FIELD = ("field", 5)
    ANNOTATION = ("annotation", 4)
```

### 2. æ™ºèƒ½å¤æ‚åº¦è®¡ç®—

æ¯ç§è¯­è¨€å®ç°äº†ä¸“é—¨çš„å¤æ‚åº¦è®¡ç®—ç®—æ³•ï¼š

#### Python å¤æ‚åº¦ç‰¹ç‚¹
- ç¼©è¿›çº§åˆ«åˆ†æï¼ˆPythonç‰¹æœ‰ï¼‰
- å¼‚æ­¥è¯­æ³•å¤æ‚åº¦
- è£…é¥°å™¨å’Œåˆ—è¡¨æ¨å¯¼å¼
- å¼‚å¸¸å¤„ç†æ¨¡å¼

#### Java å¤æ‚åº¦ç‰¹ç‚¹
- æ³›å‹ä½¿ç”¨å¤æ‚åº¦
- æ³¨è§£æ•°é‡ç»Ÿè®¡
- ç»§æ‰¿å’Œæ¥å£å®ç°
- è®¿é—®ä¿®é¥°ç¬¦å¤šæ ·æ€§

#### Rust å¤æ‚åº¦ç‰¹ç‚¹
- æ‰€æœ‰æƒå’Œå€Ÿç”¨å¤æ‚åº¦
- ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨
- æ¨¡å¼åŒ¹é…å¤æ‚åº¦
- ä¸å®‰å…¨ä»£ç æ£€æµ‹

### 3. è¯­è¨€ç‰¹å®šåˆå¹¶ç­–ç•¥

æ¯ç§è¯­è¨€å®šä¹‰äº†ç‹¬ç‰¹çš„ä»£ç å—åˆå¹¶è§„åˆ™ï¼š

```python
# Python: è£…é¥°å™¨ä¸å‡½æ•°åˆå¹¶
if (chunk1.semantic_type == PythonSemanticType.DECORATOR and 
    chunk2.semantic_type in [PythonSemanticType.FUNCTION, PythonSemanticType.CLASS]):
    return True

# Java: Javadocä¸ç±»/æ–¹æ³•åˆå¹¶
if (chunk1.name.startswith("/**") and 
    chunk2.semantic_type in [JavaSemanticType.CLASS, JavaSemanticType.METHOD]):
    return True

# Go: å¹¶å‘ç›¸å…³çš„åŒ…å£°æ˜åˆå¹¶
if (chunk1.semantic_type == GoSemanticType.IMPORT and 
    chunk2.semantic_type == GoSemanticType.IMPORT):
    return True
```

### 4. æ·±åº¦ç‰¹å¾æå–

ç³»ç»Ÿä¸ºæ¯ç§è¯­è¨€æå–ç‰¹å®šçš„ä»£ç ç‰¹å¾ï¼š

#### Python ç‰¹å¾ç¤ºä¾‹
```python
features = {
    "has_list_comprehension": True,
    "has_async_await": True,
    "has_decorators": True,
    "max_indent_level": 3,
    "has_magic_methods": True,
    "has_type_hints": True
}
```

#### Java ç‰¹å¾ç¤ºä¾‹
```python
features = {
    "has_generics": True,
    "has_lambda": True,
    "has_streams": True,
    "spring_annotations": True,
    "possible_builder_pattern": True,
    "junit_test": True
}
```

#### Rust ç‰¹å¾ç¤ºä¾‹
```python
features = {
    "has_borrowing": True,
    "has_ownership_transfer": True,
    "has_async_await": True,
    "has_unsafe_code": False,
    "has_pattern_matching": True,
    "has_lifetimes": True
}
```

## ğŸ’» ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ä½¿ç”¨

```python
from src.data.language_specific_splitters import get_language_specific_splitter
from src.data.splitter import SplitterConfig

# åˆ›å»ºé…ç½®
config = SplitterConfig(
    chunk_size=2000,
    min_semantic_chunk_size=200,
    enable_parsing_cache=True
)

# è·å–Pythonåˆ†ç‰‡å™¨
splitter = get_language_specific_splitter("python", config)
documents = splitter.split("example.py", python_code)

# æ£€æŸ¥è¯­ä¹‰ä¿¡æ¯
for doc in documents:
    semantic_info = doc.semantic_info
    print(f"è¯­è¨€: {semantic_info['language']}")
    print(f"è¯­ä¹‰ç±»å‹: {semantic_info['chunk_types']}")
    print(f"è¯­è¨€ç‰¹å¾: {semantic_info['language_specific_features']}")
```

### é«˜çº§é…ç½®

```python
# é’ˆå¯¹ä¸åŒè¯­è¨€çš„ä¼˜åŒ–é…ç½®
configs = {
    "python": SplitterConfig(
        chunk_size=1800,  # Pythonç¼©è¿›è¾ƒå°‘ï¼Œå¯ä»¥ç¨å°
        max_comment_lines_gap=2,  # Pythonæ–‡æ¡£å­—ç¬¦ä¸²å…³è”
        high_priority_independence_ratio=0.4
    ),
    "java": SplitterConfig(
        chunk_size=2500,  # Javaå†—é•¿ï¼Œå¯ä»¥ç¨å¤§
        max_comment_distance=300,  # Javadocå¯èƒ½è¾ƒé•¿
        high_priority_independence_ratio=0.3
    ),
    "rust": SplitterConfig(
        chunk_size=2000,
        min_semantic_chunk_size=150,  # Rustä»£ç è¾ƒç´§å‡‘
        high_priority_independence_ratio=0.5  # traitå’Œimplåº”è¯¥ç‹¬ç«‹
    )
}
```

### é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ

```python
from src.data.splitter import get_splitter_parser

# è‡ªåŠ¨é€‰æ‹©è¯­è¨€ç‰¹å®šåˆ†ç‰‡å™¨
splitter = get_splitter_parser("example.py", use_language_specific=True)
documents = splitter.split("example.py", content)

# å¦‚æœéœ€è¦ç¦ç”¨è¯­è¨€ç‰¹å®šå¤„ç†
splitter = get_splitter_parser("example.py", use_language_specific=False)
```

## ğŸ“Š æ€§èƒ½ç‰¹å¾

### å¤„ç†æ•ˆæœå¯¹æ¯”

| ç‰¹æ€§ | é€šç”¨åˆ†ç‰‡å™¨ | è¯­è¨€ç‰¹å®šåˆ†ç‰‡å™¨ | æå‡ |
|------|------------|----------------|------|
| è¯­ä¹‰æ„ŸçŸ¥ | åŸºç¡€ | æ·±åº¦ | 300% |
| ç‰¹å¾æå– | æ—  | ä¸°å¯Œ | æ–°åŠŸèƒ½ |
| åˆå¹¶ç²¾åº¦ | é€šç”¨è§„åˆ™ | è¯­è¨€å®šåˆ¶ | 150% |
| å¤æ‚åº¦è®¡ç®— | åŸºç¡€ | è¯­è¨€ç‰¹å®š | 200% |

### åˆ†ç‰‡è´¨é‡ç¤ºä¾‹

#### Python ä»£ç åˆ†ç‰‡
```
å—1: importè¯­å¥ + å…¨å±€å˜é‡
å—2: Userç±» (åŒ…å«__init__å’Œå±æ€§æ–¹æ³•)
å—3: asyncå‡½æ•° (åŒ…å«docstringå’Œå¼‚å¸¸å¤„ç†)
å—4: å·¥å…·å‡½æ•°ç»„åˆ
```

#### Java ä»£ç åˆ†ç‰‡
```
å—1: packageå£°æ˜ + importè¯­å¥  
å—2: UserServiceç±» (åŒ…å«Javadoc)
å—3: æ ¸å¿ƒä¸šåŠ¡æ–¹æ³• (åŒ…å«æ³¨è§£)
å—4: æ„é€ å‡½æ•°å’Œç§æœ‰æ–¹æ³•
```

## ğŸ¯ é€‚ç”¨åœºæ™¯

### 1. ä»£ç æ£€ç´¢ç³»ç»Ÿ
- **ç²¾ç¡®åŒ¹é…**: åŸºäºè¯­è¨€ç‰¹å¾çš„ç²¾ç¡®ä»£ç æ£€ç´¢
- **è¯­ä¹‰æœç´¢**: ç†è§£ä»£ç è¯­ä¹‰è€Œéä»…ä»…å…³é”®å­—åŒ¹é…
- **ç›¸å…³æ€§æ’åº**: åŸºäºå¤æ‚åº¦å’Œé‡è¦æ€§çš„ç»“æœæ’åº

### 2. ä»£ç ç†è§£å’Œåˆ†æ
- **æ¶æ„åˆ†æ**: è¯†åˆ«è®¾è®¡æ¨¡å¼å’Œæ¶æ„é£æ ¼
- **ä»£ç è´¨é‡è¯„ä¼°**: åŸºäºè¯­è¨€ç‰¹å®šæŒ‡æ ‡è¯„ä¼°ä»£ç è´¨é‡
- **é‡æ„å»ºè®®**: åŸºäºè¯­è¨€æœ€ä½³å®è·µæä¾›é‡æ„å»ºè®®

### 3. æ–‡æ¡£ç”Ÿæˆ
- **APIæ–‡æ¡£**: è‡ªåŠ¨æå–æ¥å£å’Œæ–‡æ¡£æ³¨é‡Š
- **ä»£ç ç¤ºä¾‹**: æ™ºèƒ½é€‰æ‹©æœ‰ä»£è¡¨æ€§çš„ä»£ç ç‰‡æ®µ
- **æ•™å­¦ææ–™**: æŒ‰éš¾åº¦å’Œå¤æ‚åº¦ç»„ç»‡ä»£ç ç¤ºä¾‹

### 4. ä»£ç è¿ç§»å’Œè½¬æ¢
- **è¯­è¨€é—´å¯¹æ¯”**: ç†è§£ä¸åŒè¯­è¨€çš„ç­‰ä»·æ¦‚å¿µ
- **æ¨¡å¼è¯†åˆ«**: è¯†åˆ«å¯è¿ç§»çš„è®¾è®¡æ¨¡å¼
- **ä¾èµ–åˆ†æ**: ç†è§£ä»£ç é—´çš„è¯­ä¹‰ä¾èµ–å…³ç³»

## ğŸ”® æ‰©å±•èƒ½åŠ›

### æ·»åŠ æ–°è¯­è¨€æ”¯æŒ

```python
# 1. å®šä¹‰è¯­ä¹‰ç±»å‹
class NewLanguageSemanticType(LanguageSpecificSemanticType):
    SPECIAL_CONSTRUCT = ("special", 9)
    # ... å…¶ä»–ç±»å‹

# 2. å®ç°åˆ†ç‰‡å™¨
class NewLanguageSplitter(LanguageSpecificSplitter):
    def get_language_name(self) -> str:
        return "new_language"
    
    def calculate_language_specific_complexity(self, content: str) -> float:
        # è¯­è¨€ç‰¹å®šçš„å¤æ‚åº¦è®¡ç®—
        pass
    
    # ... å®ç°å…¶ä»–æŠ½è±¡æ–¹æ³•

# 3. æ³¨å†Œåˆ°æ˜ å°„
LANGUAGE_SPLITTER_MAPPING["new_language"] = NewLanguageSplitter
```

### è‡ªå®šä¹‰ç‰¹å¾æå–

```python
class CustomPythonSplitter(PythonSplitter):
    def _extract_language_features(self, content: str) -> Dict[str, Any]:
        features = super()._extract_language_features(content)
        
        # æ·»åŠ è‡ªå®šä¹‰ç‰¹å¾
        features["has_django_models"] = 'models.Model' in content
        features["has_flask_routes"] = '@app.route' in content
        features["has_pandas_operations"] = 'pd.' in content
        
        return features
```

## ğŸ“ˆ ç›‘æ§å’Œè°ƒè¯•

### åˆ†ç‰‡è´¨é‡è¯„ä¼°

```python
def evaluate_splitting_quality(documents):
    """è¯„ä¼°åˆ†ç‰‡è´¨é‡"""
    metrics = {}
    
    # è¯­ä¹‰å®Œæ•´æ€§
    semantic_complete = sum(1 for doc in documents 
                           if doc.semantic_info.get('chunk_types'))
    metrics['semantic_completeness'] = semantic_complete / len(documents)
    
    # å¤æ‚åº¦åˆ†å¸ƒ
    complexities = []
    for doc in documents:
        complexities.extend(doc.semantic_info.get('complexity_scores', []))
    metrics['avg_complexity'] = sum(complexities) / len(complexities)
    
    # ç‰¹å¾å¤šæ ·æ€§
    all_features = set()
    for doc in documents:
        features = doc.semantic_info.get('language_specific_features', {})
        all_features.update(k for k, v in features.items() if v)
    metrics['feature_diversity'] = len(all_features)
    
    return metrics
```

### æ€§èƒ½ç›‘æ§

```python
import time
from functools import wraps

def monitor_splitting_performance(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        result = func(*args, **kwargs)
        end_time = time.time()
        
        print(f"åˆ†ç‰‡è€—æ—¶: {end_time - start_time:.3f}ç§’")
        print(f"ç”Ÿæˆå—æ•°: {len(result)}")
        print(f"å¹³å‡å—å¤§å°: {sum(len(doc.content) for doc in result) / len(result):.0f}å­—ç¬¦")
        
        return result
    return wrapper

@monitor_splitting_performance
def split_with_monitoring(splitter, path, content):
    return splitter.split(path, content)
```

## ğŸ‰ æ€»ç»“

è¯­è¨€ç‰¹å®šåˆ†ç‰‡å™¨ç³»ç»Ÿé€šè¿‡æ·±åº¦ç†è§£æ¯ç§ç¼–ç¨‹è¯­è¨€çš„ç‰¹æ€§ï¼Œå®ç°äº†ï¼š

1. **ç²¾ç¡®çš„è¯­ä¹‰ç†è§£**: åŸºäºè¯­è¨€ç‰¹å®šçš„ASTèŠ‚ç‚¹å’Œè¯­æ³•æ¨¡å¼
2. **æ™ºèƒ½çš„ä»£ç ç»„ç»‡**: ä¿æŒé‡è¦ä»£ç ç»“æ„çš„å®Œæ•´æ€§
3. **ä¸°å¯Œçš„ç‰¹å¾æå–**: è¯†åˆ«è¯­è¨€ç‰¹å®šçš„ç¼–ç¨‹æ¨¡å¼å’Œæœ€ä½³å®è·µ
4. **çµæ´»çš„æ‰©å±•æœºåˆ¶**: æ˜“äºæ·»åŠ æ–°è¯­è¨€å’Œè‡ªå®šä¹‰å¤„ç†é€»è¾‘

è¿™å¥—ç³»ç»Ÿä¸ºä»£ç åˆ†æã€æ£€ç´¢ã€ç†è§£å’Œè¿ç§»æä¾›äº†å¼ºå¤§çš„åŸºç¡€è®¾æ–½ï¼Œæ˜¯ç°ä»£ä»£ç æ™ºèƒ½ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚